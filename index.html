<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Grodowa Odyseja</title>
  <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Uncial+Antiqua&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body { font-family: 'MedievalSharp', cursive; background: url('tło gry.png') center/cover fixed; color: #f4f1e6; overflow: hidden; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .screen { display: none; padding: 16px; max-width: 480px; margin: auto; height: 100vh; overflow-y: auto; animation: fadeIn .5s; }
    .active { display: block; }
    h1,h2,h3 { text-align: center; font-family: 'Uncial Antiqua', cursive; text-shadow: 2px 2px 4px rgba(0,0,0,0.6); margin-bottom: 12px; }
    input[type="text"] { width: 100%; padding: 10px; font-size: 16px; border: none; border-radius: 6px; margin: 8px 0; }
    .btn { width: 100%; padding: 12px; font-size: 18px; color: #fff9e6; background: linear-gradient(to bottom,#c49e5b,#8b6237); border: none; border-radius: 8px; margin: 8px 0; cursor: pointer; }
    .btn:disabled { opacity: .6; cursor: default; }
    .instruction-box { background: rgba(0,0,0,0.6); border: 2px solid #8d744a; border-radius: 8px; padding: 12px; margin: 12px 0; font-size: 14px; line-height: 1.4; }
    .instruction-box ul { list-style: disc inside; margin-left: 16px; }
    .roles { display: grid; grid-template-columns: repeat(auto-fit,minmax(100px,1fr)); gap: 16px; justify-items: center; }
    .role { background: rgba(0,0,0,0.5); padding: 8px; border-radius: 12px; cursor: pointer; transition: transform .3s; text-align: center; }
    .role img { width: 100px; height: 100px; object-fit: cover; border-radius: 12px; border: 3px solid transparent; }
    .role.selected img { border-color: gold; box-shadow: 0 0 8px gold; }
    #videoOverlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; flex-direction: column; z-index: 1000; padding: 16px; }
    #videoOverlay video { width: 90%; max-width: 480px; border-radius: 12px; }
    .task-row { display: flex; gap: 8px; align-items: center; margin: 8px 0; }
    .task-row span { flex: 1; }
    .task-row input { flex: 1 1 100px; padding: 6px; border: 2px solid #444; border-radius: 4px; }
    .task-row.correct input { border-color: lime; background: rgba(0,128,0,0.2); }
    .task-row.wrong input { border-color: crimson; background: rgba(255,0,0,0.2); }
    .reset-icon { background: none; border: none; font-size: 20px; cursor: pointer; }
    #page6 { display: flex; flex-direction: column; align-items: center; text-align: center; padding: 24px; background: rgba(0,0,0,0.6); border-radius: 12px; box-shadow:0 0 16px rgba(0,0,0,0.8); height:100vh; overflow-y:auto; }
    .museum-logo { width: 100px; margin-bottom: 12px; border: 3px solid gold; padding: 4px; border-radius: 8px; }
    #finalPortrait img { width: 120px; height: 120px; object-fit: cover; border-radius:12px; border: 4px solid gold; padding:2px; }
    .badges { display: flex; gap: 16px; margin:12px 0; }
    .badges img { width: 60px; }
    .downloads { display: flex; gap: 8px; margin:12px 0; }
    #restart { margin-top: 16px; }
    @media(max-width:400px) { .btn{font-size:16px;padding:10px;} .role img{max-width:80px;height:80px;} }
  </style>
</head>
<body>
  <!-- muted to allow autoplay, will unmute on first click -->
  <audio id="bgMusic" src="celtic-glory-307625.mp3" loop muted></audio>

  <!-- 1. Rejestracja -->
  <div id="page1" class="screen active">
    <h1>GRODOWA ODYSEJA</h1>
    <div class="instruction-box">
      <ul>
        <li>1. Wpisz nazwę drużyny → <strong>DALEJ</strong></li>
        <li>2. Przeczytaj fabułę → <strong>DALEJ</strong></li>
        <li>3. Wybierz postać → <strong>DALEJ</strong></li>
        <li>4. Obejrzyj filmik → <strong>DALEJ</strong></li>
        <li>5. Wylosuj zadanie poboczne → <strong>🎲 LOSUJ</strong></li>
        <li>6. Po realizacji otrzymujesz koronę zadań → <strong>ZREALIZOWANE</strong></li>
        <li>7. Wykonaj min. 4 zadania główne</li>
        <li>8. Zatwierdź i resetuj błędy 🔄</li>
        <li>9. Kliknij <strong>PRZEJDŹ DO RADY</strong></li>
      </ul>
    </div>
    <input id="teamName" type="text" placeholder="Nazwa drużyny">
    <button id="next1" class="btn">DALEJ</button>
  </div>

  <!-- 2. Fabula -->
  <div id="page2" class="screen">
    <h2>Rok 972 – Czas Próby</h2>
    <div class="instruction-box">
      <p>Rok 972. Sopockie Grodzisko pamięta spokój ostatniego lata – lecz teraz Ziemia drży, jakby wyczuwała nadciągające przesilenie.</p>
      <p>Z południa dobiegają echa zwycięstwa pod Cedynią: książę Mieszko triumfuje, Hodon pada pod mieczem Czcibora, a cesarskie spojrzenie zwraca się ku naszym granicom.</p>
      <p>Ze wschodu płynie nowa mowa – twarde znaki Rusi, które łączą bizantyjskie krzyże z pradawnymi bałtyjskimi bóstwami, niosąc srebro i niepokój.</p>
      <p>Z zachodu zaś unoszą się słowa o chrzcie i kaplicach kamiennych: mówią, że Dąbrówka przyniosła pokój, lecz czy pokój wykuwany w żelaznej wierze jest darem czy kajdanami?</p>
      <p>A wy – tkacze, cieśle, zwiadowcy, zielarki, kowale, handlarze – strzeżecie tutaj pamięci przodków: w popiele ognisk, pod korzeniami starych dębów, w runach wyrytych na kamieniu.</p>
      <p>Was wezwano do Próby Dziedzictwa Żelaza. W ciągu godziny odnajdziecie trzy Ślady Przeszłości, by przy Radzie Starszych zadecydować:</p>
      <ul>
        <li>– Czy otworzyć Grodzisko na obce mowy, bogów i prawa…</li>
        <li>– Czy zamknąć bramy na sto lat, strzegąc ognia, który płonął tutaj, zanim wybito pierwsze monety cesarskie.</li>
      </ul>
      <p>Oto wasza chwila – chwila strażników pamięci i kowali nowych losów. Wasza Odyseja Grodowa zaczyna się teraz.</p>
    </div>
    <button id="next2" class="btn">DALEJ</button>
  </div>

  <!-- 3. Wybór postaci -->
  <div id="page3" class="screen">
    <h2>WYBIERZ POSTAĆ</h2>
    <div class="roles">
      <div class="role" data-role="zwiadowca"><img src="zwiadowca.1.png" alt="Zwiadowca"><p>Zwiadowca</p></div>
      <div class="role" data-role="tkaczka"><img src="tkaczka.1.png" alt="Tkaczka"><p>Tkaczka</p></div>
      <div class="role" data-role="zielarka"><img src="zielarka.1.png" alt="Zielarka"><p>Zielarka</p></div>
      <div class="role" data-role="kupiec"><img src="kupiec.1.png" alt="Kupiec"><p>Kupiec</p></div>
      <div class="role" data-role="rzemieslnik"><img src="rzemieslnik.1.png" alt="Rzemieślnik"><p>Rzemieślnik</p></div>
    </div>
    <button id="next3" class="btn" disabled>DALEJ</button>
  </div>

  <!-- 4. Filmik inicjacyjny -->
  <div id="videoOverlay">
    <video id="roleVideo" controls></video>
    <button id="videoNext" class="btn">DALEJ DO ZADAŃ</button>
  </div>

  <!-- 5. Zadania -->
  <div id="page4" class="screen">
    <h2>ZADANIA</h2>
    <div class="instruction-box">
      <button id="randomBtn" class="btn">🎲 LOSUJ</button>
      <p id="randomTask"></p>
      <button id="sideDone" class="btn" disabled>ZREALIZOWANE</button>
    </div>
    <div id="taskStats">Ukończono: <strong id="completedCount">0</strong>/6</div>
    <div id="tasksList">
      <div class="task-row" data-ans="LAMELKA"><span>Brama Grodziska</span><input type="text"><button class="btn confirm">ZATWIERDŹ</button><button class="reset-icon">🔄</button></div>
      <div class="task-row" data-ans="MIECH"><span>Warsztat Kowala</span><input type="text"><button class="btn confirm">ZATWIERDŹ</button><button class="reset-icon">🔄</button></div>
      <div class="task-row" data-ans="ŻYTO"><span>Zagroda</span><input type="text"><button class="btn confirm">ZATWIERDŹ</button><button class="reset-icon">🔄</button></div>
      <div class="task-row" data-ans="LEN"><span>Chata Tkaczki</span><input type="text"><button class="btn confirm">ZATWIERDŹ</button><button class="reset-icon">🔄</button></div>
      <div class="task-row" data-ans="POKRZYWA"><span>Chata Zielarki</span><input type="text"><button class="btn confirm">ZATWIERDŹ</button><button class="reset-icon">🔄</button></div>
      <div class="task-row" data-ans="DIRHEMY"><span>Chata Namiestnika</span><input type="text"><button class="btn confirm">ZATWIERDŹ</button><button class="reset-icon">🔄</button></div>
    </div>
    <button id="toCouncil" class="btn" disabled>PRZEJDŹ DO RADY</button>
  </div>

  <!-- 6. Rada -->
  <div id="page5" class="screen">
    <h2>RADA GRODU</h2>
    <div class="roles">
      <div class="role"><button class="btn" data-dec="handel">🛒 Otwarcie na handel</button></div>
      <div class="role"><button class="btn" data-dec="granice">🛡️ Zamknięcie granic</button></div>
      <div class="role"><button class="btn" data-dec="prawo">⚖️ Wprowadzenie nowego prawa</button></div>
    </div>
  </div>

  <!-- 7. Gratulacje -->
  <div id="page6" class="screen">
    <img src="logo.1.png" class="museum-logo" alt="Muzeum">
    <h1>GRATULACJE!</h1>
    <div id="finalPortrait"><img id="outPortrait" alt="Twoja postać"></div>
    <p>Drużyna: <strong id="outTeam"></strong></p>
    <p>Postać: <strong id="outRole"></strong></p>
    <p>Decyzja: <strong id="outDecisionName"></strong></p>
    <p id="outDecisionDesc"></p>
    <p>Zadanie poboczne: <strong id="outSideDone"></strong></p>
    <p>Ukończono: <strong id="outPoints"></strong>/6</p>
    <div class="badges"></div>
    <div class="downloads"></div>
    <button id="restart" class="btn">ZAGRAJ PONOWNIE</button>
  </div>

  <script>
    console.log('Grodowa Odyseja script loaded');
    document.addEventListener('DOMContentLoaded', () => {
      const bg = document.getElementById('bgMusic');
      let team='', role='', completed=0, sideDone=false;
      const vids = {
        zwiadowca:'zwiadowca.1.mp4',
        tkaczka:'tkaczka.1.mp4',
        zielarka:'zielarka.1.mp4',
        kupiec:'kupiec.1.mp4',
        rzemieslnik:'rzemieslnik.1.mp4'
      };
      const sideTasks = [
        'Znajdź coś zielonego i dotknij to.',
        'Zrób 5 przysiadów przy ławce.',
        'Znajdź kamień większy niż dłń.',
        'Zrób zdjęcie czegoś okrągłego.',
        'Znajdź coś na literę P.',
        'Podskocz 3 razy w cieniu.',
        'Ułóż literę A z patyków.',
        'Opisz kolor liścia.',
        'Zrób 10 kroków do przodu i 5 w bok.',
        'Stań na jednej nodze i licz do 10 na głos.'
      ];
      const endings = {
        handel:{name:'Otwarcie na handel',desc:`Po dniach pełnych gorących dyskusji, sprzecznych głosów i narad pod gwiazdami, Rada Grodu podjęła decyzję, która odmieniła losy krainy. Bramy zostały otwarte, strażnicy powitali pierwsze karawany, a kurz z traktów przyniósł zapachy nieznanych przypraw i szelest monet z odległych królestw. Targowiska rozbłysły kolorami, a rzemieślnicy zyskali dostęp do nowych surowców i technik.\n\nLecz z handlem przyszły też cienie. Wieści o znikających dobrach, szpiegach i dziwnych chorobach krążą po zaułkach. Grodowi nie brak bogactwa – lecz czy nie przypłaci go duszą?`},
        granice:{name:'Zamknięcie granic',desc:`Decyzja zapadła w ciszy, przerywanej jedynie trzaskiem pochodni i dźwiękiem zamykanych wrót. Rada Grodu postawiła na bezpieczeństwo. Straże podwojono, mury wzmocniono, a szlaki pokryła trawa zapomnienia. Zapanował porządek, ludzie żyją w spokoju, karmiąc się plonami własnych pól i ufając jedynie tym, których znają od dziecka.\n\nJednak z każdym dniem grodowe powietrze staje się cięższe. Zaczyna brakować inspiracji, wieści ze świata, nowości. Plotki o tajemniczych sylwetkach za murem, szeptane nocą, zaczynają niepokoić nawet najodważniejszych. Zamknięcie uratowało Grodu ciało – ale czy nie zgubiono jego ducha?`},
        prawo:{name:'Wprowadzenie nowego prawa',desc:`Głos Starszyzny niósł się echem po sali, gdy ogłoszono narodziny nowego ładu. Dotychczasowe zasady – stare jak same mury – ustąpiły miejsca świeżym postanowieniom. Ustawa objęła każdego: możnych i prostych, żołnierzy i zielarki, kupców i bardów. Jedni powitali ją z nadzieją, inni z trwogą.\n\nNowe prawo dało początek przemianom. Ale z każdym paragrafem rosła też pokusa – nadużycia, spory interpretacyjne, walki o wpływy. Czy Grodowi uda się zachować równowagę między wolą ludu a potrzebą porządku? A może reforma stanie się iskrą większego ognia?`}
      };
      function show(id){console.log('show',id);document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');}
      function updateStats(){document.getElementById('completedCount').innerText=completed;document.getElementById('toCouncil').disabled=completed<4;}

      // Start music on first button click
      document.getElementById('next1').onclick = () => {
        console.log('NEXT1 clicked'); 
        bg.muted = false; 
        bg.play().catch(e=>console.warn('Audio play failed:',e));
        const v = document.getElementById('teamName').value.trim(); 
        if (!v) return alert('Podaj nazwę drużyny'); 
        team = v; 
        show('page2');
      };
      document.getElementById('next2').onclick = () => { console.log('NEXT2 clicked'); show('page3'); };
      document.querySelectorAll('#page3 .role').forEach(el=>el.onclick=()=>{
        console.log('Role selected',el.dataset.role);
        document.querySelectorAll('#page3 .role').forEach(r=>r.classList.remove('selected'));
        el.classList.add('selected');
        role = el.dataset.role;
        document.getElementById('next3').disabled = false;
      });
      document.getElementById('next3').onclick = () => {
        console.log('NEXT3 clicked'); 
        document.getElementById('roleVideo').src = vids[role];
        document.getElementById('videoOverlay').style.display = 'flex';
      };
      document.getElementById('videoNext').onclick = () => { console.log('Video NEXT clicked');
        document.getElementById('videoOverlay').style.display = 'none';
        sideDone = false; completed = 0; updateStats(); show('page4');
        document.getElementById('sideDone').disabled = true;
        document.getElementById('sideDone').innerText = 'ZREALIZOWANE';
        document.getElementById('sideDone').style.background = '';
        document.getElementById('randomTask').innerText = '';
        document.querySelectorAll('.task-row').forEach(r=>{r.classList.remove('correct','wrong'); r.querySelector('input').value='';});
      };
      document.getElementById('randomBtn').onclick = () => {
        console.log('Random task'); 
        document.getElementById('randomTask').innerText = sideTasks[Math.floor(Math.random()*sideTasks.length)];
        document.getElementById('sideDone').disabled = false;
      };
      document.getElementById('sideDone').onclick = function(){
        console.log('SideDone clicked'); 
        sideDone = true; this.innerText = 'ZREALIZOWANE'; this.style.background='lime';
      };
      document.querySelectorAll('.task-row').forEach(row=>{
        const ans=row.dataset.ans, inp=row.querySelector('input'),
              btn=row.querySelector('.confirm'), clr=row.querySelector('.reset-icon');
        btn.onclick = ()=>{
          console.log('Confirm task', ans);
          const v=inp.value.trim().toUpperCase();
          if(v===ans){ if(!row.classList.contains('correct')){ row.classList.remove('wrong'); row.classList.add('correct'); completed++; }}
          else { if(row.classList.contains('correct')){ row.classList.remove('correct'); completed--; } row.classList.add('wrong'); }
          updateStats();
        };
        clr.onclick = ()=>{
          console.log('Reset task', ans);
          if(row.classList.contains('correct')){ row.classList.remove('correct'); completed--; }
          row.classList.remove('wrong');
          inp.value='';
          updateStats();
        };
      });
      document.getElementById('toCouncil').onclick = ()=>{ console.log('To council'); show('page5'); };
      document.querySelectorAll('#page5 .btn[data-dec]').forEach(b=>b.onclick=()=>{
        const key=b.dataset.dec;
        console.log('Council choice', key);
        document.getElementById('outTeam').innerText=team;
        document.getElementById('outRole').innerText=role;
        document.getElementById('outDecisionName').innerText=endings[key].name;
        document.getElementById('outDecisionDesc').innerText=endings[key].desc;
        document.getElementById('outPortrait').src=`${role}.png`;
        document.getElementById('outSideDone').innerText = sideDone?'TAK':'NIE';
        document.getElementById('outPoints').innerText = completed;
        const badges=document.querySelector('.badges');
        badges.innerHTML = sideDone? `<img src="korona.1.png" alt="Korona zadań">` : ``;
        const dl=document.querySelector('.downloads');
        dl.innerHTML = sideDone? `<a href="korona.1.png" download class="btn">POBIERZ KORONĘ</a>` : ``;
        show('page6');
      }));
      document.getElementById('restart').onclick = ()=>{ console.log('Restarting'); 
        team=''; role=''; completed=0; sideDone=false;
        document.getElementById('teamName').value='';
        document.getElementById('next3').disabled=true;
        document.getElementById('sideDone').disabled=true;
        document.getElementById('sideDone').innerText='ZREALIZOWANE';
        document.getElementById('sideDone').style.background='';
        document.getElementById('completedCount').innerText='0';
        document.getElementById('randomTask').innerText='';
        document.querySelectorAll('.task-row').forEach(r=>{r.classList.remove('correct','wrong'); r.querySelector('input').value='';});
        document.querySelector('.badges').innerHTML='';
        document.querySelector('.downloads').innerHTML='';
        show('page1');
      };
    });
  </script>
</body>
</html>
