<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gra terenowa RPG – Dziedzictwo Żelaza</title>

  <!-- Leaflet CSS (jeśli będziesz osadzał mapę) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet/dist/leaflet.css"
  />

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;500;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #f5f0e8;
      --primary: #7b5e34;
      --accent: #c08d4a;
      --text: #333;
      --panel-bg: rgba(255,255,255,0.9);
    }
    * { box-sizing:border-box; margin:0; padding:0; }
    body {
      font-family: 'Roboto', sans-serif;
      background: var(--bg) url('tlo.png') center/cover no-repeat;
      color: var(--text);
    }
    .screen {
      display: none;
      max-width:800px;
      margin:2rem auto;
      background: var(--panel-bg);
      padding:2rem;
      border-radius:10px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
    }
    .active { display:block; }
    h1,h2 { text-align:center; margin-bottom:1rem; color:var(--primary); }
    p { margin-bottom:1rem; line-height:1.5; }
    button {
      background: var(--primary); color:#fff;
      border:none; padding:0.75rem 1.5rem;
      border-radius:5px; cursor:pointer;
      font-size:1rem;
      transition:background .2s;
    }
    button:hover { background: var(--accent); }
    /* Roles */
    .roles { display:flex; flex-wrap:wrap; gap:1rem; justify-content:center; margin:1rem 0; }
    .role {
      border:2px solid #ccc; border-radius:8px;
      padding:0.5rem; width:120px; text-align:center;
      transition:border-color .2s, transform .2s;
      cursor:pointer;
      background:#fff;
    }
    .role img { width:100%; border-radius:5px; }
    .role.selected { border-color: var(--accent); transform:scale(1.05); }
    /* Progress panel */
    #progressPanel {
      background:#fff; padding:1rem; border:1px solid #ddd;
      border-radius:8px; margin-top:1rem;
    }
    #progressPanel h3 { margin-bottom:0.5rem; font-size:1.1rem; }
    #progressList { list-style:none; display:grid; grid-template-columns:repeat(3,1fr); gap:0.5rem; }
    #progressList li {
      background:#eee; padding:0.5rem; border-radius:4px; text-align:center;
      font-size:0.9rem;
    }
    #progressList li.done { background:lightgreen; }
    /* Map container */
    #map { height:300px; border-radius:8px; margin-top:1rem; }
    /* Chat box */
    #chatBox {
      position:fixed; bottom:1rem; right:1rem;
      width:200px; height:150px;
      background:#fff; border:1px solid #ccc;
      border-radius:8px; padding:0.5rem;
      overflow-y:auto; font-size:0.85rem;
      box-shadow:0 2px 6px rgba(0,0,0,0.2);
    }
    #chatInput {
      position:fixed; bottom:1rem; right:1rem;
      width:calc(200px - 20px); margin-top:160px;
      padding:0.5rem; border:1px solid #ccc;
      border-radius:4px; background:#fff;
    }
  </style>
</head>
<body>

  <!-- 1. Intro fabularny -->
  <section id="intro" class="screen active">
    <h1>Dziedzictwo Żelaza</h1>
    <p>
      Rok 972. Ziemia drży, imperia patrzą łapczywie – a Ty wraz z drużyną masz ocalić pamięć przodków!
    </p>
    <p>
      Odwiedź min. 4 z 6 punktów edukacyjnych, wykonaj zadania, zdobądź Fragmenty Dziedzictwa, weź udział w Radzie Starszych i zdecyduj o przyszłości Grodu.
    </p>
    <div style="text-align:center">
      <button onclick="showScreen('selectRole')">Rozpocznij przygodę</button>
    </div>
  </section>

  <!-- 2. Wybór drużyny i roli -->
  <section id="selectRole" class="screen">
    <h2>Wybierz drużynę i rolę</h2>
    <p>Podaj nazwę drużyny:</p>
    <input type="text" id="teamName" placeholder="Nazwa drużyny" style="width:100%; padding:.5rem; margin-bottom:1rem;"/>
    <div class="roles">
      <div class="role" onclick="selectRole('Zwiadowca', this)">
        <img src="zwiadowca.png" alt="">
        <strong>Zwiadowca</strong>
      </div>
      <div class="role" onclick="selectRole('Tkaczka', this)">
        <img src="tkaczka.png" alt="">
        <strong>Tkaczka</strong>
      </div>
      <div class="role" onclick="selectRole('Zielarka', this)">
        <img src="zielarka (2).png" alt="">
        <strong>Zielarka</strong>
      </div>
      <div class="role" onclick="selectRole('Kupiec', this)">
        <img src="kupiec.png" alt="">
        <strong>Kupiec</strong>
      </div>
      <div class="role" onclick="selectRole('Rzemieślnik', this)">
        <img src="rzemieslnik.png" alt="">
        <strong>Rzemieślnik</strong>
      </div>
      <div class="role" onclick="selectRole('Starszy', this)">
        <img src="starszy.png" alt="">
        <strong>Starszy</strong>
      </div>
    </div>
    <div style="text-align:center">
      <button id="toMapBtn" disabled onclick="startGame()">Dalej</button>
    </div>
  </section>

  <!-- 3. Główny ekran mapy -->
  <section id="mapView" class="screen">
    <h2>Mapa Grodu</h2>
    <div id="map">Ładowanie mapy…</div>
    <div id="progressPanel">
      <h3>Postępy:</h3>
      <ul id="progressList">
        <li>Punkt 1</li><li>Punkt 2</li><li>Punkt 3</li>
        <li>Punkt 4</li><li>Punkt 5</li><li>Punkt 6</li>
      </ul>
      <div style="text-align:center; margin-top:1rem;">
        <button onclick="showScreen('taskScreen')" disabled id="toTaskBtn">Szczegóły zadania</button>
      </div>
    </div>
  </section>

  <!-- 4. Ekran zadania -->
  <section id="taskScreen" class="screen">
    <h2 id="taskTitle">Zadanie</h2>
    <p id="taskDesc">Opis zadania</p>
    <!-- Tu możesz wstawić QR, quiz czy pole rysunku -->
    <div style="text-align:center; margin-top:1rem;">
      <button onclick="completeTask()">Zatwierdź zadanie</button>
    </div>
  </section>

  <!-- 5. Certyfikat -->
  <section id="certificate" class="screen">
    <h2>Medalion Grodu i Certyfikat</h2>
    <img src="certyfikat1.png" alt="" style="display:block; margin:1rem auto; max-width:100%;"/>
    <p style="text-align:center;">
      Gratulacje! Twoja drużyna zdobyła wszystkie Fragmenty Dziedzictwa i pomogła ocalić przeszłość Grodu.
    </p>
  </section>

  <!-- 6. Chat Mędrzeców -->
  <div id="chatBox"></div>
  <input id="chatInput" placeholder="Napisz do Mędrców…" onkeypress="if(event.key==='Enter') sendChat()" />

  <!-- Leaflet JS (do mapy) -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    const screens = ['intro','selectRole','mapView','taskScreen','certificate'];
    let selectedRole=null, sideTask=null, completed=0;

    function showScreen(id){
      screens.forEach(s=>document.getElementById(s).classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function selectRole(role,el){
      selectedRole=role;
      document.querySelectorAll('.role').forEach(r=>r.classList.remove('selected'));
      el.classList.add('selected');
      document.getElementById('toMapBtn').disabled=false;
      // losowanie zadania pobocznego
      const sideTasks=[
        "Znaleźć ukryty symbol",
        "Ułożyć fragmenty mapy",
        "Odszyfrować runiczną wiadomość",
        "Zadanie logiczne na spostrzegawczość",
        "Utrzymać społeczną równowagę"
      ];
      sideTask=sideTasks[Math.floor(Math.random()*sideTasks.length)];
      addChat(`Twoje zadanie poboczne: ${sideTask}`);
    }

    function startGame(){
      addChat(`Wybrano rolę: ${selectedRole}`);
      initMap();
      showScreen('mapView');
    }

    // Inicjalizacja mapy Leaflet (przykład Sopotu)
    function initMap(){
      const map=L.map('map').setView([54.443,18.560],15);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:''}).addTo(map);
      // przykładowy marker
      L.marker([54.443,18.560]).addTo(map).bindPopup('Twój Grodu');
    }

    function completeTask(){
      // oznaczamy kolejne li jako done
      const lis=document.querySelectorAll('#progressList li');
      if(completed<lis.length){
        lis[completed].classList.add('done');
        completed++;
        addChat(`Zadanie ukończone! (${completed}/6)`);
      }
      if(completed>=4){
        document.getElementById('toTaskBtn').disabled=false;
      }
      if(completed===6){
        finishCouncil();
      } else {
        showScreen('mapView');
      }
    }

    function finishCouncil(){
      addChat("Przechodzicie do Rady Starszych...");
      showScreen('certificate');
    }

    // Chat Mędrzeców
    function addChat(msg){
      const box=document.getElementById('chatBox');
      box.innerHTML += `<div>${msg}</div>`;
      box.scrollTop = box.scrollHeight;
    }
    function sendChat(){
      const inp=document.getElementById('chatInput');
      const txt=inp.value.trim();
      if(!txt) return;
      addChat(`<strong>Gracz:</strong> ${txt}`);
      setTimeout(()=>addChat(`<strong>Mędrzec:</strong> ${generateHint(txt)}`),500);
      inp.value='';
    }
    function generateHint(q){
      return "Pamiętaj, by dokładnie zbadać okolicę przy każdym punkcie!";
    }
  </script>
</body>
</html>
