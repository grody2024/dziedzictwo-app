<!DOCTYPE html>
<html lang="pl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <title>Grodowa Odyseja</title>
  <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Uncial+Antiqua&display=swap"
    rel="stylesheet"> <!-- Czcionki średniowieczne -->
  <link rel="stylesheet" href="styles.css"> <!-- Dodano link do arkusza stylów -->
</head>

<body>
  <audio id="bgMusic" src="resources/mp3/celtic_festival.mp3" playsinline></audio>

  <!-- 1. Instrukcja gry -->
  <div id="page1" class="screen active">
    <h1>GRODOWA ODYSEJA</h1>
    <div class="instruction-box">
      <h3>Mechanika gry „Dziedzictwo”</h3>
      <p>1. Wprowadzenie fabularne – zapoznajcie się z realiami Pomorza X wieku.</p>
      <p>2. Tworzenie drużyny – wybierzcie nazwę drużyny, wprowadzając ją poniżej.</p>
      <p>3. Wybór postaci – każda rola niesie unikalne możliwości.</p>
      <p>4. Zadania – wykonajcie 4 z 6 głównych zadań oraz 1 zadanie poboczne.</p>
      <p>5. Rada Grodu – wybierzcie decyzję, która zadecyduje o losach grodu.</p>
    </div>
    <input id="teamName" type="text" placeholder="Nazwa drużyny">
    <button class="btn" id="to2">DALEJ</button>
  </div>

  <!-- 2. Pełna fabuła -->
  <div id="page2" class="screen">
    <h2>PEŁNA FABUŁA</h2>
    <div class="instruction-box">
      <p>Rok 972. Sopockie Grodzisko pamięta spokój ostatniego lata – lecz teraz Ziemia drży, jakby wyczuwała
        nadciągające przesilenie.</p>
      <p>Z południa dobiegają echa zwycięstwa pod Cedynią: książę Mieszko triumfuje, Hodon pada pod mieczem Czcibora, a
        cesarskie spojrzenie zwraca się ku naszym granicom.</p>
      <p>Ze wschodu płynie nowa mowa – twarde znaki Rusi, które łączą bizantyjskie krzyże z pradawnymi bałtyckimi
        bóstwami, niosąc srebro i niepokój.</p>
      <p>Z zachodu zaś unoszą się słowa o chrzcie i kamiennych kaplicach: mówią, że Dąbrówka przyniosła pokój, lecz czy
        pokój wykuwany w żelaznej wierze jest darem czy kajdanami?</p>
      <p>A wy – tkacze, cieśle, zwiadowcy, zielarki, kowale, handlarze – strzeżecie pamięć przodków: w popiele ognisk,
        pod korzeniami starych dębów, w runach wyrytych na kamieniu.</p>
      <ul>
        <li>– Czy otworzyć Grodzisko na obce mowy, bogów i prawo?</li>
        <li>– Czy zamknąć bramy na sto lat, strzegąc ognia, który płonął tutaj, zanim wybito pierwsze monety cesarskie?
        </li>
      </ul>
    </div>
    <button class="btn" id="to3">DALEJ</button>
  </div>

  <!-- 3. Wybór postaci -->
  <div id="page3" class="screen">
    <h2>WYBIERZ POSTAĆ</h2>
    <div class="roles">
      <div class="role" data-role="zwiadowca"><img src="resources/images/zwiadowca.png" alt="Zwiadowca">
        <p>Zwiadowca</p>
      </div>
      <div class="role" data-role="tkaczka"><img src="resources/images/tkaczka.png" alt="Tkaczka">
        <p>Tkaczka</p>
      </div>
      <div class="role" data-role="zielarka"><img src="resources/images/zielarka.png" alt="Zielarka">
        <p>Zielarka</p>
      </div>
      <div class="role" data-role="kupiec"><img src="resources/images/kupiec.png" alt="Kupiec">
        <p>Kupiec</p>
      </div>
      <div class="role" data-role="kowal"><img src="resources/images/kowal.png" alt="Kowal">
        <p>Kowal</p>
      </div>
    </div>
    <button class="btn" id="to4" disabled>DALEJ</button>
  </div>

  <!-- 4. Filmik inicjacyjny -->
  <div id="videoOverlay" class="screen"
    style="display:none;align-items:center;justify-content:center;flex-direction:column;">
    <video id="roleVideo" controls></video>
    <button class="btn" id="videoNext">DALEJ DO ZADAŃ</button>
  </div>

  <!-- 5. Interaktywne zadania -->
  <div id="page4" class="screen">
    <h2>INTERAKTYWNE ZADANIA</h2>
    <div class="instruction-box">
      <p>Wykonaj 4 główne zadania w lokacjach: Brama Grodziska, Warsztat Kowala, Chata Zielarki, Chata Tkaczki, Chata
        wodza oraz Targowisko. Wylosuj i zrealizuj 1 zadanie poboczne.</p>
    </div>
    <button class="btn" id="drawBtn">🎲 LOSUJ ZADANIE POBOCZNE</button>
    <p id="randomTask"></p>
    <button class="btn" id="sideBtn" disabled>ZREALIZOWANE</button>
    <button class="btn" id="toCouncil" disabled>PRZEJDŹ DO RADY</button>
    <p>Ukończono: <span id="count">0</span>/6</p>
    <div id="tasksList">
      <div class="task-row" data-ans="LAMELKA"><span>Brama Grodziska</span><input type="text"><button
          class="btn confirm">ZATWIERDŹ</button><button class="reset-icon">🔄</button></div>
      <div class="task-row" data-ans="MIECH"><span>Warsztat Kowala</span><input type="text"><button
          class="btn confirm">ZATWIERDŹ</button><button class="reset-icon">🔄</button></div>
      <div class="task-row" data-ans="ŻYTO"><span>Targowisko</span><input type="text"><button
          class="btn confirm">ZATWIERDŹ</button><button class="reset-icon">🔄</button></div>
      <div class="task-row" data-ans="LEN"><span>Chata Tkaczki</span><input type="text"><button
          class="btn confirm">ZATWIERDŹ</button><button class="reset-icon">🔄</button></div>
      <div class="task-row" data-ans="POKRZYWA"><span>Chata Zielarki</span><input type="text"><button
          class="btn confirm">ZATWIERDŹ</button><button class="reset-icon">🔄</button></div>
      <div class="task-row" data-ans="DIRHEMY"><span>Chata wodza</span><input type="text"><button
          class="btn confirm">ZATWIERDŹ</button><button class="reset-icon">🔄</button></div>
    </div>
  </div>

  <!-- 6. Rada Grodu -->
  <div id="page5" class="screen">
    <h2>RADA GRODU – DECYZYJNA KULMINACJA</h2>
    <button class="btn" id="endTrade">🛒 Otwarcie na handel</button>
    <button class="btn" id="endClose">🛡️ Zamknięcie granic</button>
    <button class="btn" id="endLaw">⚖️ Wprowadzenie nowego prawa</button>
  </div>

  <!-- 7. Podsumowanie rozgrywki -->
  <div id="page6" class="screen">
    <img src="resources/images/logo.png" class="museum-logo" alt="Muzeum">
    <h1>GRATULACJE!</h1>
    <div id="finalPortrait"><img id="avatar" alt="Twoja postać"></div>
    <div class="final-box">
      <p><strong>Drużyna:</strong> <span id="resTeam"></span></p>
      <p><strong>Postać:</strong> <span id="resRole"></span></p>
      <p><strong>Zadania główne:</strong> <span id="resCount"></span>/6</p>
      <p><strong>Zadanie poboczne:</strong> <span id="resSide"></span></p>
      <p><strong>Decyzja Rady:</strong> <span id="resDec"></span></p>
      <p id="resDesc" style="white-space:pre-wrap;margin-top:8px"></p>
      <div class="badges"></div>
      <div class="downloads"></div>
      <p class="note">🏅 Naklejkę korony otrzymuje ten, kto wykonał zadanie losowe.</p>
    </div>
    <button class="btn" id="restartBtn">ZAGRAJ PONOWNIE</button>
  </div>

  <script>
    const musicTracks = [
    'resources/mp3/celtic_dance.mp3',
    'resources/mp3/celtic_festival.mp3',
    'resources/mp3/celtic_legends.mp3',
    'resources/mp3/celtic_morning.mp3'
  ];
  let currentTrack = 0;
  const bgMusic = document.getElementById('bgMusic');

  function playTrack(idx) {
    bgMusic.src = musicTracks[idx];
    bgMusic.play().catch(() => {});
  }

  function startBackgroundMusic() {
    playTrack(currentTrack);
  }

  bgMusic.addEventListener('ended', () => {
    currentTrack = (currentTrack + 1) % musicTracks.length;
    playTrack(currentTrack);
  });

  window.addEventListener('DOMContentLoaded', startBackgroundMusic);

  let team = '', role = '', count = 0, sideDone = false;
  const vids = { zwiadowca: 'resources/mp4/zwiadowca.mp4', tkaczka: 'resources/mp4/tkaczka.mp4', zielarka: 'resources/mp4/zielarka.mp4', kupiec: 'resources/mp4/kupiec.mp4', kowal: 'resources/mp4/kowal.mp4' };
  const avatars = { zwiadowca: 'resources/images/zwiadowca.png', tkaczka: 'resources/images/tkaczka.png', zielarka: 'resources/images/zielarka.png', kupiec: 'resources/images/kupiec.png', kowal: 'resources/images/kowal.png' };
  const sideTasks = [
    'Znajdź coś zielonego i dotknij to.',
    'Zrób 5 przysiadów przy ławce.',
    'Znajdź kamień większy niż dłoń.',
    'Zrób zdjęcie czegoś okrągłego.',
    'Znajdź coś na literę P.',
    'Podskocz 3 razy w cieniu.',
    'Ułóż literę A z patyków.',
    'Opisz kolor liścia.',
    'Zrób 10 kroków do przodu i 5 w bok.',
    'Stań na jednej nodze i licz do 10 na głos.'
  ];
  const endings = {
    handel: { name: 'Otwarcie na handel', desc: 'Po dniach pełnych gorących dyskusji, sprzecznych głosów i narad pod gwiazdami, Rada Grodu wyłoniła nowe możliwości wymiany. Bramy otwarto, kupcy przybyli z odległych krain, a w powietrzu unosił się zapach przypraw i dźwięk monet. Rzemieślnicy poszerzyli horyzonty, ale równocześnie wzrosło ryzyko chorób i oszustw. Grodzisko stało się prężnym ośrodkiem handlu - czy zyskało dzięki temu swe prawdziwe dziedzictwo?' },
    granice: { name: 'Zamknięcie granic', desc: 'W obawie przed nieznanym Rada podjęła decyzję o zamknięciu murów. Straże wzmocniono, handel ograniczono, a mieszkańcy zwrócili się ku własnym plonom. Spokój zapanował, ale wraz z nim narastała izolacja. Ciche szeptania o bogactwach poza murami pobudzały tęsknotę. Czy bezpieczeństwo usprawiedliwiło utratę wolności ducha?' },
    prawo: { name: 'Wprowadzenie nowego prawa', desc: 'Pod przewodnictwem starszyzny wprowadzono świeże ustawy. Każdy – możny i prosty – musiał podporządkować się nowym paragrafom. Spory szybko narosły, gdy reguły interpretowano na różne sposoby. Nowe prawo obiecało porządek, ale także rozpoczęło walkę o wpływy i odsłoniło pęknięcia w jedności wspólnoty. Czy ów ład zdołał przetrwać burze ambicji?' }
  };

  function show(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  document.getElementById('to2').addEventListener('click', () => {
    const input = document.getElementById('teamName');
    if (!input.value.trim()) alert('Podaj nazwę drużyny');
    else { team = input.value.trim(); show('page2'); startBackgroundMusic(); }
  });

  document.getElementById('to3').addEventListener('click', () => show('page3'));

  document.querySelectorAll('.role').forEach(el => el.addEventListener('click', () => {
    role = el.dataset.role;
    document.querySelectorAll('.role').forEach(r => r.classList.toggle('selected', r === el));
    document.getElementById('to4').disabled = false;
  }));

  document.getElementById('to4').addEventListener('click', () => {
    document.getElementById('roleVideo').src = vids[role];
    document.getElementById('videoOverlay').style.display = 'flex';
  });

  document.getElementById('videoNext').addEventListener('click', () => {
    document.getElementById('videoOverlay').style.display = 'none';
    show('page4');
  });

  function updateStats() {
    document.getElementById('count').innerText = count;
    document.getElementById('toCouncil').disabled = count < 4;
  }

  document.querySelectorAll('.confirm').forEach(btn => btn.addEventListener('click', () => {
    const row = btn.closest('.task-row');
    const answer = row.dataset.ans;
    const user = row.querySelector('input').value.trim().toUpperCase();
    if (user === answer) {
      if (!row.classList.contains('correct')) { row.classList.remove('wrong'); row.classList.add('correct'); count++; }
    } else {
      if (row.classList.contains('correct')) { row.classList.remove('correct'); count--; }
      row.classList.add('wrong');
    }
    updateStats();
  }));

  document.querySelectorAll('.reset-icon').forEach(btn => btn.addEventListener('click', () => {
    const row = btn.closest('.task-row');
    if (row.classList.contains('correct')) { row.classList.remove('correct'); count--; }
    row.classList.remove('wrong');
    row.querySelector('input').value = '';
    updateStats();
  }));

  document.getElementById('drawBtn').addEventListener('click', () => {
    document.getElementById('randomTask').innerText = sideTasks[Math.floor(Math.random() * sideTasks.length)];
    document.getElementById('sideBtn').disabled = false;
  });

  document.getElementById('sideBtn').addEventListener('click', () => {
    sideDone = true;
    document.getElementById('sideBtn').style.background = 'lime';
  });

  document.getElementById('toCouncil').addEventListener('click', () => show('page5'));

  document.getElementById('endTrade').addEventListener('click', () => finish('handel'));
  document.getElementById('endClose').addEventListener('click', () => finish('granice'));
  document.getElementById('endLaw').addEventListener('click', () => finish('prawo'));

  function finish(dec) {
    document.getElementById('resTeam').innerText = team;
    document.getElementById('resRole').innerText = role;
    document.getElementById('resCount').innerText = count;
    document.getElementById('resSide').innerText = sideDone ? 'TAK' : 'NIE';
    document.getElementById('resDec').innerText = endings[dec].name;
    document.getElementById('resDesc').innerText = endings[dec].desc;
    document.getElementById('avatar').src = avatars[role];
    document.querySelector('.badges').innerHTML = '<img src="resources/images/medalion.png" alt="Medalion">' + (sideDone ? '<img src="resources/images/korona.png" alt="Korona">' : '');
    document.querySelector('.downloads').innerHTML = '<a href="resources/images/medalion.png" download class="btn">POBIERZ MEDALION</a>' + (sideDone ? '<a href="resources/images/korona.png" download class="btn">POBIERZ KORONĘ</a>' : '');
    show('page6');
  }

  document.getElementById('restartBtn').addEventListener('click', () => {
    team = ''; role = ''; count = 0; sideDone = false;
    document.getElementById('teamName').value = '';
    document.querySelectorAll('.task-row').forEach(r => r.classList.remove('correct', 'wrong'));
    document.querySelectorAll('#tasksList input').forEach(i => i.value = '');
    document.getElementById('randomTask').innerText = '';
    document.getElementById('sideBtn').disabled = true;
    document.getElementById('sideBtn').style.background = '';
    document.querySelectorAll('.role').forEach(r => r.classList.remove('selected'));
    document.getElementById('to4').disabled = true;
    document.getElementById('toCouncil').disabled = true;
    updateStats();
    show('page1');
  });
  </script>
</body>
</html>