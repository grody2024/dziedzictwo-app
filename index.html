# Program do gry terenowej RPG: Dziedzictwo Żelaza
# Autor: ChatGPT <3

from flask import Flask, request, redirect, render_template_string
import random

app = Flask(__name__)

# Baza danych drużyn (tymczasowa - do testów)
teams = {}

# Dostępne role z opisami
roles = {
    "Zwiadowca": "Nieustraszony tropiciel, który przeczesuje teren w poszukiwaniu śladów przeszłości. Jego instynkt i spryt pomagają drużynie unikać niebezpieczeństw.",
    "Tkaczka": "Mistrzyni wzorów i symboli. Potrafi odczytywać ukryte znaczenia i szyfry ukryte w dawnych tkaninach i ornamentach.",
    "Zielarka": "Znawczyni ziół i natury. Leczy, rozpoznaje rośliny i zna tajniki przyrody, które mogą przynieść przewagę w trudnych chwilach.",
    "Kupiec": "Negocjator i handlarz. Potrafi przekonać każdego do swojej racji i zdobyć potrzebne informacje nawet w najbardziej napiętych sytuacjach.",
    "Rzemieślnik": "Złota rączka Grodu. Rozwiązuje zagadki techniczne, naprawia urządzenia i buduje to, co niezbędne do przetrwania.",
    "Starszy": "Duchowy przywódca drużyny. Jego słowo często decyduje o kierunku wyprawy i ostatecznych wyborach Grodu. Mądrość ponad wszystko."
}

# Lista zadań pobocznych
side_quests = [
    "Znalezienie ukrytego symbolu",
    "Ułożenie fragmentów mapy",
    "Odszyfrowanie runicznej wiadomości",
    "Zadanie logiczne na spostrzegawczość",
    "Utrzymanie społecznej równowagi w grupie"
]

# Strona rejestracji
template_register = '''
<!DOCTYPE html>
<html>
<head><title>Rejestracja drużyny</title></head>
<body>
  <h1>Dziedzictwo Żelaza – Rejestracja Drużyny</h1>
  <form action="/register" method="post">
    Nazwa drużyny: <input type="text" name="team_name" required><br><br>
    Ilość członków (3-6): <input type="number" name="members" min="3" max="6" required><br><br>
    <input type="submit" value="Zarejestruj">
  </form>
</body>
</html>
'''

# Ekran z wprowadzeniem i przydzieleniem ról
@app.route("/register", methods=["GET", "POST"])
def register():
    if request.method == "POST":
        team_name = request.form["team_name"]
        members = int(request.form["members"])
        if team_name in teams:
            return f"Drużyna o nazwie {team_name} już istnieje. Wybierz inną nazwę."
        if len(teams) >= 50:
            return "Limit drużyn został osiągnięty."

        assigned_roles = random.sample(list(roles.items()), members)
        side_missions = random.sample(side_quests, members)
        team_data = [{"rola": role, "opis": desc, "misja": mission} for (role, desc), mission in zip(assigned_roles, side_missions)]
        teams[team_name] = team_data

        # Wyświetlenie wyników rejestracji
        result_html = f"<h2>Drużyna: {team_name}</h2><ul>"
        for i, member in enumerate(team_data):
            result_html += f"<li><strong>Gracz {i+1}:</strong> {member['rola']} – {member['opis']}<br>Misja poboczna: {member['misja']}</li><br>"
        result_html += "</ul><a href='/'>Powrót</a>"
        return result_html
    return render_template_string(template_register)

# Strona główna
@app.route("/")
def index():
    return render_template_string(template_register)

if __name__ == "__main__":
    app.run(debug=True)
